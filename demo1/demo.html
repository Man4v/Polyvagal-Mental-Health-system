<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>State Selection Demo</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { color: #333; }
    .word-option { margin: 8px 0;}
    .word-btn {
        margin-right: 150px;
        margin-bottom: 30px;
        padding: 8px 14px;
        border: none;
        border-radius: 6px;
        background: #ddd;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.2s;
    }

    .word-btn.selected {
        background: #4CAF50;  /* green when selected */
        color: white;
    }

    .intensity-slider {
        margin: 5px 0 15px 0;
    }
    #wordsContainer {
        display: flex;
        flex-wrap: wrap;       /* wrap to next row if too many */
        gap: 10px;             /* spacing between buttons */
        margin: 10px 0;
    }
    button { margin-top: 20px; padding: 8px 12px;}
    .result { margin-top: 20px; font-weight: bold; }
    .bar { height: 20px; margin: 5px 0; background: lightgray; position: relative; border-radius: 5px; }
    .bar span { position: absolute; left: 5px; top: 0; color: white; font-size: 12px; }
  </style>
</head>
<body>

  <h2>Select Words & Intensities</h2>
  <form id="wordForm">
    <div id="wordsContainer"></div>
    <button type="button" onclick="submitSelection()">Submit</button>
  </form>

  <div id="output" class="result"></div>

  <script>
    // Load words from Flask backend
    async function loadWords() {
      let response = await fetch("http://127.0.0.1:5000/words");
      let words = await response.json();

      let container = document.getElementById("wordsContainer");
      words.forEach(word => {
        let div = document.createElement("div");
        div.classList.add("word-option");
        div.innerHTML = `
        <button type="button" style="border-radius:20px;" class="word-btn" data-word="${word}" onclick="toggleWord(this)">
            ${word}
        </button>
        <div class="intensity-slider" id="slider-${word}" style="display:none;">
            Intensity:
            <input type="range" name="intensity-${word}" min="0" max="5" value="0" step="1" 
                oninput="this.nextElementSibling.value = this.value">
            <output>0</output>
        </div>
        `;

        container.appendChild(div);
      });
    }

    function toggleWord(button) {
    let word = button.dataset.word;
    let sliderDiv = document.getElementById(`slider-${word}`);

    if (button.classList.contains("selected")) {
        // Deselect
        button.classList.remove("selected");
        sliderDiv.style.display = "none";
    } else {
        // Select
        button.classList.add("selected");
        sliderDiv.style.display = "block";
    }
    }

    // Calculate & display results
    async function submitSelection() {
    let selected = [];
    const buttons = document.querySelectorAll(".word-btn.selected");

    buttons.forEach(btn => {
        let word = btn.dataset.word;
        let intensity = document.querySelector(`input[name='intensity-${word}']`).value;
        selected.push({word: word, intensity: parseInt(intensity)});
    });

    let response = await fetch("http://127.0.0.1:5000/predict", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(selected)
    });

    let result = await response.json();
    renderResults(result);
    }



    function renderResults(result) {
      let resultHTML = "<h3>Results:</h3>";
      for (let state in result) {
        let pct = result[state].toFixed(1);
        let color = state === "hypo" ? "blue" : state === "hyper" ? "red" : "green";
        resultHTML += `
          <div>${state.toUpperCase()}: ${pct}%</div>
          <div class="bar">
            <div style="width:${pct}%; background:${color}; height:100%; border-radius:5px;">
              <span>${pct}%</span>
            </div>
          </div>
        `;
      }
      document.getElementById("output").innerHTML = resultHTML;
    }

    // Load words on page load
    loadWords();
  </script>

</body>
</html>
